{% extends 'admin/master.html' %}

{% block body %}
<div>
  {% block model_menu_bar %}
  <ul class="nav nav-tabs">
    <li class="nav-item">
      <a href="javascript:void(0)" class="nav-link active">List ({{ payments|length }})</a>
    </li>
  </ul>
  {% endblock %}

  <div class="table-responsive">
    <table class="table table-striped table-bordered table-hover model-list">
      <thead>
        <tr>
          <th>&nbsp;</th>
          <th>Payment ID</th>
          <th>Provider</th>
          <th>Amount</th>
          <th>Currency</th>
          <th>State</th>
          <th>Update State</th>
        </tr>
      </thead>
      <tbody>
        {% for p in payments %}
        <tr>
          <td class="list-buttons-column">
            <form method="POST" action="{{ url_for('.refund') }}" class="d-inline">
              <input type="hidden" name="payment_id" value="{{ p.session_id }}">
              <button type="submit" class="btn btn-sm btn-warning"
                onclick="return confirm('Mark {{ p.session_id }} as refunded?')">
                Refund
              </button>
            </form>
            <form method="POST" action="{{ url_for('.cancel') }}" class="d-inline ml-1">
              <input type="hidden" name="payment_id" value="{{ p.session_id }}">
              <button type="submit" class="btn btn-sm btn-danger"
                onclick="return confirm('Cancel payment {{ p.session_id }}?')">
                Cancel
              </button>
            </form>
            <form method="POST" action="{{ url_for('.sync') }}" class="d-inline ml-1">
              <input type="hidden" name="payment_id" value="{{ p.session_id }}">
              <button type="submit" class="btn btn-sm btn-info">Sync</button>
            </form>
          </td>
          <td><small>{{ p.session_id }}</small></td>
          <td>{{ p.provider }}</td>
          <td>{{ p.amount }}</td>
          <td>{{ p.currency }}</td>
          <td>
            {% if p.state == 'succeeded' %}
              <span class="badge badge-success">{{ p.state }}</span>
            {% elif p.state == 'failed' %}
              <span class="badge badge-danger">{{ p.state }}</span>
            {% elif p.state == 'cancelled' %}
              <span class="badge badge-dark">{{ p.state }}</span>
            {% elif p.state == 'refunded' %}
              <span class="badge badge-warning">{{ p.state }}</span>
            {% elif p.state == 'processing' %}
              <span class="badge badge-info">{{ p.state }}</span>
            {% else %}
              <span class="badge badge-secondary">{{ p.state }}</span>
            {% endif %}
          </td>
          <td>
            <form method="POST" action="{{ url_for('.update') }}" class="form-inline">
              <input type="hidden" name="payment_id" value="{{ p.session_id }}">
              <select name="state" class="form-control form-control-sm mr-1">
                {% for value, label in state_choices %}
                <option value="{{ value }}" {% if value == p.state %}selected{% endif %}>{{ label }}</option>
                {% endfor %}
              </select>
              <button type="submit" class="btn btn-sm btn-primary">Update</button>
            </form>
          </td>
        </tr>
        {% else %}
        <tr>
          <td colspan="7">
            <div class="text-center">No payments recorded yet.</div>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>
{% endblock %}
